define(["jquery","underscore","backbone","app/models/band","app/collections/band-related-list","app/collections/band-search-query","app/views/search-result","lib/jqueryui-custom/jquery-ui.min","lib/jquery-dialogextend/jquery.dialogextend"],function($,_,Backbone,Band,BandRelatedList,BandSearchQuery,SearchResultView){"use strict";return Backbone.View.extend({el:"#search",initialize:function(){this.$searchInput=this.$el.find("#search-input"),this.$searchResults=this.$el.find("#search-results"),this.$tBody=this.$searchResults.find("#search-results-table").children("tbody"),this.$count=this.$el.find("#search-results-count"),this.$count.css({height:this.$searchInput.outerHeight()+"px","line-height":this.$searchInput.outerHeight()+"px"}),this.$el.dialog({autoOpen:!0,closeOnEscape:!1,draggable:!0,height:250,modal:!1,position:{my:"left top",at:"left top",of:window},resizable:!1,title:"Search",width:450}).dialogExtend({closable:!1,collapsable:!0}).show("fast"),this.listenTo(this.collection,"reset",this.render)},events:{"click #search-btn":"_searchBtn","keypress #search-input":"_searchKb"},render:function(){return this.$tBody.empty(),this.$count.text(this.collection.length+" band(s) found."),this.collection.each(this._renderOne,this),this.$searchResults.show(),this.trigger("search:searched"),this},_renderOne:function(model){var searchResultView=new SearchResultView({model:model});return this.listenTo(searchResultView,"search-result:select",function(band){this.trigger("search:select",band)}),this.$tBody.append(searchResultView.render().$el),this},_searchBtn:function(){var searchText=this.$searchInput.val();this._isSearchValid(searchText)&&this._search(searchText)},_searchKb:function(e){if(13===e.which){var searchText=this.$searchInput.val();this._isSearchValid(searchText)&&this._search(searchText)}},_search:function(txt){this.stopListening(null,"search-result:select"),this.trigger("search:searching"),this.collection.fetch({data:new BandSearchQuery(txt).build(),success:function(){},error:function(){}})},_isSearchValid:function(txt){return!!txt}})});