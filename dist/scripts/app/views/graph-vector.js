define(["jquery","underscore","backbone","text!templ/graph-vector.html","app/utils/math-ext","app/models/band","app/collections/band-related-list","app/collections/band-related-query","app/utils/number-ext"],function($,_,Backbone,Template,MathExt,Band,BandRelatedList,BandRelatedQuery,NumberExt){"use strict";return Backbone.View.extend({POSITION_OFFSET:-40,_childrenLoaded:!1,template:_.template(Template),events:{"click .graph-vector-expand-related-wrapper > .toggle-link":function(){this.trigger("graph-vector:hide-band-info"),this._childrenLoaded?(this._childrenLoaded=!1,this.model.clearRelatedBands({isSourceOfReset:!0})):this.model.get("relatedBands").fetch({data:new BandRelatedQuery(this.model.get("id")).build(),parentBand:this.model,success:_.bind(function(){this._childrenLoaded=!0},this),error:function(){}})},"click .graph-vector-expand-details-wrapper > .toggle-link":function(){this.trigger("graph-vector:show-band-info",this.model,this.$el)}},initialize:function(options){Object.defineProperties(this,{x:{get:function(){return this._x},set:function(val){this.prevX=this._x,this._x=NumberExt.toInteger(val)},enumerable:!0},y:{get:function(){return this._y},set:function(val){this.prevY=this._y,this._y=NumberExt.toInteger(val)},enumerable:!0},prevX:{get:function(){return this._prevX},set:function(val){this._prevX=val},enumerable:!0},prevY:{get:function(){return this._prevY},set:function(val){this._prevY=val},enumerable:!0},hasMoved:{get:function(){return this.x!==this.prevX||this.y!==this.prevY},enumerable:!0}}),_.extend(this,_.pick(options,"x","y","prevX","prevY")),this.$el.addClass("graph-vector").css({left:this.x+this.POSITION_OFFSET+"px",top:this.y+this.POSITION_OFFSET+"px"})},render:function(){var data=this.model.toJSON();return _.extend(data,{toggleClass:this._childrenLoaded?"fa-minus-circle":"fa-plus-circle"}),this.$el.html(this.template(data)),this},remove:function(){return this.$el.fadeOut("fast",_.bind(function(){Backbone.View.prototype.remove.call(this)},this)),this},animate:function(){var dfd=$.Deferred();return this.$el.animate({left:this.x+this.POSITION_OFFSET+"px",top:this.y+this.POSITION_OFFSET+"px"},"fast","swing",function(){dfd.resolve()}),dfd.promise()}})});